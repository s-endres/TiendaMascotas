
@{
    ViewBag.Title = "Create";
}

<!-- Select JavaScript -->
<link href="/bower_components/select2/css/select2.min.css" rel="stylesheet" type="text/css">
<script src="/bower_components/select2/js/select2.min.js"></script>
<!-- Custom Fonts -->
<link href="/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">



<h2>Create</h2>

<script>
    $(document).ready(function () {

        $("#selectCategory").select2({
            placeholder: "Select a Category",
                allowClear: true
        });

        $("#selectProductType").select2({
            placeholder: "Select a ProductType",
            allowClear: true
        });


        //<--Event jQuery -->

        $("#createProductType").click(function () {

            window.location.replace('http://localhost:58176/ProductType/Index');
        })

        $("#btnSave").click(function () {
            createProduct();
        });

        $("#myModal").on('hidden.bs.modal', function () {
            $summernoteModal.code("");
            $("#myModal p[Class='alert alert-danger']").remove();

        })
        $.ajaxSetup({ async: false });
        $.ajax({
            type: "GET",
            url: "http://localhost:58176/Category/getAllCategories",
            data: "",
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function () {
                    $("#selectCategory").append("<option value=" + this.Id + " onclick =\"optionsProductType(this)\">" + this.Name + "</option>");
                });
            }
        });
    });


    function createProduct() {
        if (validateMyForm()) {
            $.ajax({
                type: "POST",
                url: "http://localhost:58176/Product/AddProduct",
                data: JSON.stringify({
                    Code: $("#inputCode").val(),
                    Name: $("#inputName").val(),
                    Price: $("#inputPrice").val(),
                    IdProductType: O$("#inputIdProductType").val()
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    if (data) {

                        window.location.replace('http://localhost:58176/Product/Index');
                    }
                    else {
                        ValidateMyAlert("Class='alert alert-danger'", 'data is false', 'Warning', "#alertContainer");
                    }
                },
                error: function () {
                    ValidateMyAlert("Class='alert alert-danger'", 'Error', 'Danger', "#alertContainer");
                }
            });
        }
    }

    function optionsProductType(button)
    {

        $("#selectProductType option").remove();
        $.ajax({
            type: "GET",
            url: "http://localhost:58176/ProductType/getAllProductType",
            data: "",
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $.each(data, function () {
                    if (this.IdCategory =)
                        $("#selectProductType").append("<option value=" + this.Id + ">" + this.Name + "</option>");
                });
            }
        });
    }

    //Validations
    function ValidateMyAlert(pClass, pString, tMessege, insertSide) {
        if (!$("p[" + pClass + "]").length) {
            $(insertSide).prepend("<p " + pClass + "><strong>" + tMessege + "</strong> " + pString + " </p>");
        }
        else {
            $("p[" + pClass + "]").remove();
            $(insertSide).prepend("<p " + pClass + "><strong>" + tMessege + "</strong> " + pString + " </p>");
        }
    }

    function validateMyForm() {
        var cellEmpty = true;
        if (!$.isNumeric($("input[type='number']").val()) || $("input[type='number']").val() <= 0 ){
            changeClass($("input[type='number']").parent(), "has-success", "has-error");
            ValidateMyAlert("Class='alert alert-danger'", 'Size is Required', 'Warning', "#alertContainer");
            cellEmpty = false;
        }
        else { changeClass($("input[type='number']").parent(), "has-error", "has-success"); }

        if ($("select[class='form-control'").val() == null) {
            changeClass($("select[class='form-control'").parent(), "has-success", "has-error");
            ValidateMyAlert("Class='alert alert-danger'", 'Conditions is Required', 'Warning', "#alertContainer");
            cellEmpty = false;
        }
        else { changeClass($("select[class='form-control]").parent(), "has-error", "has-success"); }


        return cellEmpty;
    }

    function changeClass(input, classRemove, classAdd) {
        input.removeClass(classRemove);
        input.addClass(classAdd);
    }

</script>


<div class="form-horizontal">
    <div class="panel-heading">
        create new Category
        <button type="button" class="glyphicon glyphicon-plus" id="createCategory"></button>
    </div>

    <div id="alertContainer"> </div>

    <div class="form-group">
        <label class="control-label col-md-2">Code</label>
        <div class="col-md-10">
            <input type="text" id="inputCode" class="form-control"></input>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2">Name</label>
        <div class="col-md-10">
            <input type="text" id="inputName" class="form-control"></input>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2">Category</label>
        <div class="col-md-10">
            <select id="selectCategory" class="form-control" > </select>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-md-2">ProductType</label>
        <div class="col-md-10">
            <select id="selectProductType" class="form-control"> </select>
        </div>
    </div>

    <div class="form-group">
        <label class="control-label col-md-2">Price</label>
        <div class="col-md-10">
            <input type="number" id="inputPrice" class="form-control"></input>
        </div>
    </div>

    <div class="form-group">
        <div>
            <input type="button" id="btnSave" value="Create" class="btn btn-default"/>
        </div>
    </div>
</div>